<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Login - Açaí da Barra</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        primary: "#6D28D9",
                        "background-light": "#F9FAFB",
                        "background-dark": "#1F2937",
                        "surface-light": "#FFFFFF",
                        "surface-dark": "#374151",
                        "text-light": "#111827",
                        "text-dark": "#F9FAFB",
                        "secondary-text-light": "#6B7280",
                        "secondary-text-dark": "#D1D5DB",
                        danger: "#EF4444"
                    },
                    fontFamily: {
                        display: ["Poppins", "sans-serif"],
                    },
                    borderRadius: {
                        DEFAULT: "0.75rem",
                    },
                },
            },
        };
    </script>
    <style>
        .material-icons {
            vertical-align: middle;
        }
    </style>
</head>
<body class="bg-background-light dark:bg-background-dark font-display min-h-screen">
    <div class="flex flex-col md:flex-row min-h-screen">
        <div class="w-full md:w-1/2 bg-[#D4F4D4] dark:bg-purple-900/20 flex items-center justify-center p-8 md:p-12 transition-all duration-300">
            <div class="text-center">
                <img alt="Mascote roxo de um olho só, sorrindo e usando um boné branco com a logo Açaí da Barra" class="max-w-xs md:max-w-md lg:max-w-lg mx-auto transform hover:scale-105 transition-transform duration-500" src="https://lh3.googleusercontent.com/aida-public/AB6AXuAFeM1Bzl4h11sKPp-1UZnnFsOHnJoG00VjHEcTfTxQG0GAa1JRc4aALHBcOuCQsGfG6_-isEthzrb6bVpgG6CVCuoILmX5a7Qgfi5r2yirPZ0tnPKL8_p3k4fgQTc24XLG3jrnYVVFOQV-iZX03bwLd6YqELZzhqGrMWOzxP7uWcFbPHt8pzv-B9sBIHbxcqiowAM1uR_7fZesonMaFNGkrms_G3dIpEhUsIUyaTiJuKq-fOoG5tAwHvFBvhOXVyplc6Fw89W6PRzI" />
                <div class="mt-8 text-center hidden md:block">
                    <h2 class="text-2xl font-bold text-text-light dark:text-text-dark">A energia que você precisa!</h2>
                    <p class="mt-2 text-secondary-text-light dark:text-secondary-text-dark">Faça login e peça o melhor açaí da região.</p>
                </div>
            </div>
        </div>
        <div class="w-full md:w-1/2 flex items-center justify-center p-6 md:p-12 bg-surface-light dark:bg-surface-dark">
            <div class="w-full max-w-md space-y-8">
                <div class="text-center md:text-left">
                    <h1 class="text-4xl font-bold text-primary">Bem-vindo de volta!</h1>
                    <p class="mt-2 text-lg text-secondary-text-light dark:text-secondary-text-dark">Acesse sua conta para continuar.</p>
                </div>
                <div id="login-feedback" class="hidden rounded-DEFAULT border border-danger/20 bg-danger/10 px-4 py-3 text-sm text-danger" role="alert" aria-live="assertive"></div>
                <form id="login-form" class="space-y-6" novalidate>
                    <div>
                        <label class="block text-sm font-medium text-text-light dark:text-text-dark mb-2" for="username">Nome de Usuário (Login)</label>
                        <div class="relative rounded-md shadow-sm">
                            <span class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                                <i class="material-icons text-gray-400">person_outline</i>
                            </span>
                            <input class="block w-full rounded-DEFAULT border-gray-300 dark:border-gray-600 bg-background-light dark:bg-background-dark pl-10 focus:border-primary focus:ring-primary sm:text-sm py-3 text-text-light dark:text-text-dark" id="username" name="username" placeholder="Digite seu usuário" type="text" autocomplete="username" required />
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-text-light dark:text-text-dark mb-2" for="password">Senha de Acesso</label>
                        <div class="relative rounded-md shadow-sm">
                            <span class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                                <i class="material-icons text-gray-400">lock_outline</i>
                            </span>
                            <input class="block w-full rounded-DEFAULT border-gray-300 dark:border-gray-600 bg-background-light dark:bg-background-dark pl-10 pr-10 focus:border-primary focus:ring-primary sm:text-sm py-3 text-text-light dark:text-text-dark" id="password" name="password" placeholder="Digite sua senha" type="password" autocomplete="current-password" required />
                            <button class="absolute inset-y-0 right-0 flex items-center pr-3 cursor-pointer" id="toggle-password-btn" type="button" aria-label="Mostrar ou ocultar senha">
                                <i class="material-icons text-gray-400 hover:text-primary" id="eye-icon">visibility_off</i>
                            </button>
                        </div>
                    </div>
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <input class="h-4 w-4 rounded border-gray-300 text-primary focus:ring-primary" id="remember-me" name="remember-me" type="checkbox" />
                            <label class="ml-2 block text-sm text-secondary-text-light dark:text-secondary-text-dark" for="remember-me">Lembrar-me</label>
                        </div>
                        <div class="text-sm">
                            <a class="font-medium text-primary hover:text-primary/80" href="#">Esqueceu sua senha?</a>
                        </div>
                    </div>
                    <div class="flex flex-col space-y-4">
                        <button id="submit-button" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-DEFAULT shadow-sm text-sm font-medium text-white bg-primary hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary transition-all duration-300 transform hover:scale-105 disabled:opacity-60 disabled:hover:scale-100 disabled:cursor-not-allowed" type="submit">
                            Entrar
                        </button>
                        <button id="create-account-btn" class="w-full flex justify-center py-3 px-4 border border-gray-300 dark:border-gray-600 rounded-DEFAULT shadow-sm text-sm font-medium text-primary bg-transparent hover:bg-primary/10 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary transition-all duration-300" type="button">
                            Ainda não tem uma conta? Cadastre-se
                        </button>
                    </div>
                </form>
                <div class="text-center md:hidden mt-8">
                    <h2 class="text-xl font-bold text-text-light dark:text-text-dark">A energia que você precisa!</h2>
                    <p class="mt-1 text-sm text-secondary-text-light dark:text-secondary-text-dark">Peça o melhor açaí da região.</p>
                </div>
            </div>
        </div>
    </div>
    <script>
        const togglePassword = () => {
            const passwordInput = document.getElementById('password');
            const eyeIcon = document.getElementById('eye-icon');
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                eyeIcon.innerText = 'visibility';
            } else {
                passwordInput.type = 'password';
                eyeIcon.innerText = 'visibility_off';
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            const storedUserString = sessionStorage.getItem('acai-user') || localStorage.getItem('acai-user');
            if (storedUserString) {
                window.location.replace('index.html');
                return;
            }

            const togglePasswordBtn = document.getElementById('toggle-password-btn');
            const loginForm = document.getElementById('login-form');
            const feedback = document.getElementById('login-feedback');
            const submitButton = document.getElementById('submit-button');
            const rememberMe = document.getElementById('remember-me');
            const usernameInput = document.getElementById('username');
            const passwordInput = document.getElementById('password');
            const createAccountBtn = document.getElementById('create-account-btn');

            togglePasswordBtn.addEventListener('click', togglePassword);
            createAccountBtn.addEventListener('click', () => {
                feedback.classList.remove('hidden');
                feedback.textContent = 'Entre em contato com o administrador para criar uma nova conta.';
            });

            const setLoading = (isLoading) => {
                submitButton.disabled = isLoading;
                submitButton.innerText = isLoading ? 'Entrando...' : 'Entrar';
            };

            loginForm.addEventListener('submit', async (event) => {
                event.preventDefault();
                feedback.classList.add('hidden');
                feedback.textContent = '';

                const username = usernameInput.value.trim();
                const password = passwordInput.value;

                if (!username || !password) {
                    feedback.textContent = 'Informe usuário e senha para continuar.';
                    feedback.classList.remove('hidden');
                    return;
                }

                setLoading(true);
                try {
                    const response = await fetch('/api/login', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ username, password })
                    });
                    const data = await response.json();
                    if (!response.ok) {
                        throw new Error(data?.error || 'Não foi possível realizar o login.');
                    }

                    const userData = {
                        id: data.userId,
                        username,
                        role: data.role || 'user',
                        photo: data.photo || null
                    };
                    sessionStorage.setItem('acai-user', JSON.stringify(userData));
                    if (rememberMe.checked) {
                        localStorage.setItem('acai-user', JSON.stringify(userData));
                    } else {
                        localStorage.removeItem('acai-user');
                    }

                    window.location.href = 'index.html';
                } catch (error) {
                    feedback.textContent = error.message;
                    feedback.classList.remove('hidden');
                } finally {
                    setLoading(false);
                }
            });
        });
    </script>
</body>
</html>
